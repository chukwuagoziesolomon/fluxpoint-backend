# ============================================================================
# CELL 4 QUICK REFERENCE - WHAT GETS VALIDATED
# ============================================================================

## ğŸ“‹ THE 7 VALIDATION RULES AT A GLANCE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ TREND                         â”‚ MA alignment + slopes + structure        â”‚
â”‚    MA6 > MA18 > MA50 > MA200 (uptrend)                                     â”‚
â”‚    All slopes positive (slope6, slope18, slope50 > 0)                       â”‚
â”‚    Higher highs AND higher lows in recent 50 candles                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2ï¸âƒ£ FIBONACCI                     â”‚ Price retraced 38.2%, 50%, or 61.8%      â”‚
â”‚    NOT deeper than 61.8% (no 78.6% or deeper)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2.5ï¸âƒ£ SWING STRUCTURE             â”‚ Curved pullback pattern (not sharp V)    â”‚
â”‚    Smooth retracement with multiple swing points                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3ï¸âƒ£ AT MA LEVEL                  â”‚ Price within 2% of: MA6, MA18, MA50, MA200â”‚
â”‚    Dynamic support/resistance (NOT horizontal S/R levels)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3.5ï¸âƒ£ MA RETEST                  â”‚ SECOND touch, not first bounce            â”‚
â”‚    Price touched MA â†’ moved away â†’ came back (retest)                      â”‚
â”‚    Lookback: 50-200 candles depending on timeframe                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4ï¸âƒ£ CANDLESTICK PATTERN          â”‚ At retest point, pattern must appear:    â”‚
â”‚    BUY: Pin Bar, Rejection, Engulfing, Morning Star                        â”‚
â”‚    SELL: Bearish equivalents (upper wick pin bar, etc)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5ï¸âƒ£ HIGHER TIMEFRAME              â”‚ If using HTF: must be in same direction  â”‚
â”‚    BUY: HTF in uptrend | SELL: HTF in downtrend                            â”‚
â”‚    âš ï¸ SKIPPED for single-timeframe (H1-only) training                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6ï¸âƒ£ CORRELATION                   â”‚ Correlated pairs must move together       â”‚
â”‚    Correlation threshold: 0.6 (60% minimum)                                â”‚
â”‚    âš ï¸ SKIPPED for single-pair training                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7ï¸âƒ£ RISK MANAGEMENT               â”‚ SL = 1.5Ã—ATR, TP = dynamic RR ratio     â”‚
â”‚    Position size = Risk$ / (SL pips Ã— $/pip)                               â”‚
â”‚    Account balance Ã— Risk% / (SL distance Ã— pip value)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ MOVING AVERAGES USED

**CORRECT MAs for Cell 4** (NOT MA5/MA20!):
```
MA6   = 6-period moving average
MA18  = 18-period moving average
MA50  = 50-period moving average
MA200 = 200-period moving average

UPTREND:   MA6 > MA18 > MA50 > MA200  âœ…
DOWNTREND: MA200 > MA50 > MA18 > MA6  âœ…
```

## ğŸ“Š CANDLESTICK PATTERNS DETECTED

**For BUY entries:**
```
PIN BAR:           Long lower wick + small body
  â”‚
  â”œâ”€â”€â”€â”€â”€
  â”‚ â•‘ (body)
  â”‚â”€â”˜ (long wick)

REJECTION:         Close at top after testing low
  â”€â”€â”€ 
    â”‚ (wick down)
  â”€â”€â”˜

ENGULFING:         Large green engulfs small red
  â”ƒ    (green)
  â”—â”€â”ƒ  (red)

MORNING STAR:      3-candle V-pattern
  â”‚
  â”œâ”€ (gap down)
  â”‚â”€ (small)
  â”œâ”€ (gap up)
  â””â”€ (bullish)
```

**For SELL entries:** Same patterns but inverted (upper wicks instead of lower)

## ğŸ’° RISK MANAGEMENT CALCULATIONS

**Stop Loss:**
```
SL_distance = 1.5 Ã— ATR (minimum 12 pips)
BUY:  SL_price = Entry - SL_distance
SELL: SL_price = Entry + SL_distance
```

**Take Profit (Dynamic):**
```
if SL_distance < 20 pips:
    TP_distance = 2 Ã— SL_distance    (RR 1:2)
else:
    TP_distance = 1.5 Ã— SL_distance  (RR 1:1.5)

BUY:  TP_price = Entry + TP_distance
SELL: TP_price = Entry - TP_distance
```

**Position Sizing:**
```
Risk_amount = Account_balance Ã— Risk%
Lots = Risk_amount / (SL_pips Ã— Pip_value_per_lot)

Example:
Account: $10,000
Risk: 1% = $100
SL: 20 pips
Pip value (EURUSD): $10 per pip per lot
Lots = $100 / (20 Ã— $10) = 0.50 lots
```

## ğŸ¯ WHAT CELL 4 DISPLAYS FOR EACH SETUP FOUND

```
Symbol:           EURUSD
Date:             2025-06-15 10:30:00
Entry Price:      1.10150
Direction:        BUY

Risk Management:
  â€¢ SL:           1.10350 (20 pips below entry)
  â€¢ TP:           1.10750 (40 pips above entry)
  â€¢ Risk/Reward:  1:2.0
  â€¢ Position:     0.50 lots
  â€¢ Risk $:       $100.00

Moving Averages:
  â€¢ MA6:          1.10100
  â€¢ MA18:         1.10080
  â€¢ MA50:         1.10050
  â€¢ MA200:        1.09900
  â€¢ ATR:          0.00100

Validation:
  1ï¸âƒ£  Trend: âœ…
  2ï¸âƒ£  Fibonacci: âœ…
  2.5ï¸âƒ£ Swing: âœ…
  3ï¸âƒ£  MA Level: âœ…
  3.5ï¸âƒ£ MA Retest: âœ…
  4ï¸âƒ£  Candlestick: âœ…
  5ï¸âƒ£  Multi-TF: âœ…
  6ï¸âƒ£  Correlation: âœ…
  7ï¸âƒ£  Risk Mgmt: âœ…
```

## âœ… SUCCESS CHECKLIST

When running Cell 4 in Colab:

- [ ] Cell runs without errors
- [ ] Scans 15 pairs for valid setups
- [ ] Shows count of valid setups found (should be >0, not 0!)
- [ ] Displays 3 sample setups with all details
- [ ] Shows Risk Management values for each setup
- [ ] All 7 validation rules showing âœ… for each setup
- [ ] Neural network trains on valid setups
- [ ] Shows training progress (epoch, loss)
- [ ] Final accuracy >70%
- [ ] Saves model to Google Drive

## âŒ TROUBLESHOOTING

**Problem: 0 valid setups found**

Likely causes:
- [ ] Wrong moving averages (are you using MA6/MA18 or MA5/MA20?)
- [ ] Trend structure broken (check MA alignment and slopes)
- [ ] Candlestick patterns not detected (check pattern detection logic)
- [ ] MA retest pattern not in historical data (need older price action)
- [ ] Fibonacci validation too strict

**Problem: Training accuracy too low (<50%)**

Likely causes:
- [ ] Invalid setups selected (check validation rules)
- [ ] Features not properly normalized
- [ ] Model architecture doesn't fit the data
- [ ] Training data size too small (<50 setups)

**Problem: Risk Management values seem wrong**

Check:
- [ ] ATR calculation (should be 14-period)
- [ ] SL should be 1.5Ã—ATR (minimum 12 pips)
- [ ] TP should be 1:2 RR (or 1:1.5 for large SL)
- [ ] Position size should scale with risk

---

## ğŸ“š REFERENCE FILES

- **CELL4_COMPLETE_TCE_VALIDATION.py** - Main Cell 4 code (paste into Colab)
- **CELL4_VALIDATION_CHECKLIST.md** - Detailed explanation of each rule
- **TCE_VALIDATION_RULES_COMPLETE.md** - Full rule documentation
- **DEBUG_VALIDATION_RULES.py** - Test script to verify rules work locally
